<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>IM接口文档 | 清幽傲竹的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="通用 请求URL： http://IP:20001/api/im 签名：      md5(timestamp + md5(school_id + account_id + 盐巴) ) 盐巴为：  Tk07EiJfCcrL 请求时，头部需带上：Content-Type:application/json 每次请求都需传入唯一的timestamp(小于32位的时间戮或随机数,保证每次不一样即可) co">
<meta name="keywords" content="IM">
<meta property="og:type" content="article">
<meta property="og:title" content="IM接口文档">
<meta property="og:url" content="https://fjfzeagle.github.io/2017/08/03/IM接口文档/index.html">
<meta property="og:site_name" content="清幽傲竹的博客">
<meta property="og:description" content="通用 请求URL： http://IP:20001/api/im 签名：      md5(timestamp + md5(school_id + account_id + 盐巴) ) 盐巴为：  Tk07EiJfCcrL 请求时，头部需带上：Content-Type:application/json 每次请求都需传入唯一的timestamp(小于32位的时间戮或随机数,保证每次不一样即可) co">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://fjfzeagle.github.io/upload_image/集备组聊天界面.png">
<meta property="og:updated_time" content="2017-08-03T03:18:53.888Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IM接口文档">
<meta name="twitter:description" content="通用 请求URL： http://IP:20001/api/im 签名：      md5(timestamp + md5(school_id + account_id + 盐巴) ) 盐巴为：  Tk07EiJfCcrL 请求时，头部需带上：Content-Type:application/json 每次请求都需传入唯一的timestamp(小于32位的时间戮或随机数,保证每次不一样即可) co">
<meta name="twitter:image" content="https://fjfzeagle.github.io/upload_image/集备组聊天界面.png">
  
    <link rel="alternate" href="/atom.xml" title="清幽傲竹的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">清幽傲竹的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fjfzeagle.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-IM接口文档" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/03/IM接口文档/" class="article-date">
  <time datetime="2017-08-03T03:00:24.000Z" itemprop="datePublished">2017-08-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      IM接口文档
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="通用"><a href="#通用" class="headerlink" title="通用"></a>通用</h2><ul>
<li>请求URL： <a href="http://IP:20001/api/im" target="_blank" rel="external">http://IP:20001/api/im</a></li>
<li>签名：      md5(timestamp + md5(school_id + account_id + 盐巴) )</li>
<li>盐巴为：  Tk07EiJfCcrL</li>
<li>请求时，头部需带上：Content-Type:application/json</li>
<li>每次请求都需传入唯一的timestamp(小于32位的时间戮或随机数,保证每次不一样即可)</li>
<li>code:为0表示成功，其它值表示错误，用msg显示</li>
<li>请求json中的expanded参数：传0时，返回的json是经过压缩的,传1时，适合用在ajax请求中，返回的json未经压缩，建议传0，此参数可以不传，后台默认压缩json</li>
<li>json中必须传的参数：cmd、school_id、account_id</li>
<li>请求json中的值，如果要求传的是数值，必须传数值类型，不能加上双引号以字符传输</li>
<li>http返回200才表示结果正常响应，非200的情况下，响应json串中msg表示错误的信息 400:服务器不理解请求的语法, 401:签名错误</li>
<li>if http_status=200 then {正常解析数据}  else {showErrorMsg(json.s[‘msg’]);} </li>
<li>后台使用account_id值来判断每次传输的timestamp是否唯一</li>
<li>查看此文档建议安装Typora，下载地址: <a href="http://typora.io/" target="_blank" rel="external">http://typora.io/</a> </li>
</ul>
<h2 id="获取用户聊天群列表"><a href="#获取用户聊天群列表" class="headerlink" title="获取用户聊天群列表"></a>获取用户聊天群列表</h2><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getChatRoomList"</span>,<span class="attr">"school_id"</span>:<span class="number">1</span>,<span class="attr">"account_id"</span>:<span class="number">4541</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"d383df6ff01e49c86c4ac976ec42fbff"</span>,<span class="attr">"expanded"</span>:<span class="number">1</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">6</span>,<span class="attr">"values"</span>:[<span class="string">"im_group_id"</span>,<span class="string">"relation_id"</span>,<span class="string">"group_name"</span>,<span class="string">"group_type"</span>,<span class="string">"easemob_group_id"</span>,<span class="string">"isOwner"</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="string">"德育处"</span>,<span class="string">"teacher"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">64</span>,<span class="number">20000001</span>,<span class="string">"高一年段任课老师"</span>,<span class="string">"teacher"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">68</span>,<span class="number">30000002</span>,<span class="string">"数学教研组"</span>,<span class="string">"teacher"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">83</span>,<span class="number">40001002</span>,<span class="string">"高一数学集备组"</span>,<span class="string">"teacher"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">145</span>,<span class="number">50000000</span>,<span class="string">"全校教职工"</span>,<span class="string">"teacher"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">332</span>,<span class="number">60567002</span>,<span class="string">"高一(10)班数学"</span>,<span class="string">"class_course"</span>,<span class="string">""</span>,<span class="number">1</span>,<span class="number">376</span>,<span class="number">60571002</span>,<span class="string">"高一(14)班数学"</span>,<span class="string">"class_course"</span>,<span class="string">""</span>,<span class="number">1</span>,<span class="number">747</span>,<span class="number">304</span>,<span class="string">"高一(10)班师生群"</span>,<span class="string">"teacherAndStudent"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">751</span>,<span class="number">308</span>,<span class="string">"高一(14)班师生群"</span>,<span class="string">"teacherAndStudent"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">873</span>,<span class="number">304</span>,<span class="string">"高一(10)班家校群"</span>,<span class="string">"teacherAndGuardian"</span>,<span class="string">""</span>,<span class="number">0</span>,<span class="number">877</span>,<span class="number">308</span>,<span class="string">"高一(14)班家校群"</span>,<span class="string">"teacherAndGuardian"</span>,<span class="string">""</span>,<span class="number">0</span>],<span class="attr">"rowCount"</span>:<span class="number">11</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>返回字段说明</p>
<ol>
<li>im_group_id：中心库中的组ID</li>
<li>group_name：组名</li>
<li>group_type：组类型，值范围：’teacherAndGuardian’:家校群,’teacherAndStudent’:师生群,’guardian’:家长群,’teacher’:老师群,’student’:学生群,’other’:其他群,’class_course’:学科群,’corporation’:社团群</li>
<li>easemob_group_id：环信系统中的组ID,<strong>如果easemob_group_id值为空，表示群还未创建(未激活)</strong></li>
<li>isOwner：<strong>是否是群主,如果为1，表示有权限激活该群</strong></li>
<li><strong>如果easemob_group_id值为空并且isOwner=1,则需显示激活按钮，让用户点击按钮进行群激活</strong></li>
<li><strong>所有群在用户点击群组时判断群ID如果为空则发起激活</strong></li>
</ol>
</li>
</ul>
<h2 id="激活聊天群"><a href="#激活聊天群" class="headerlink" title="激活聊天群"></a>激活聊天群</h2><ul>
<li><p>请求</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"activeGroup"</span>,<span class="attr">"school_id"</span>:<span class="number">1</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"im_group_id"</span>:<span class="number">1496</span>,<span class="attr">"im_user_id"</span>:<span class="number">151345</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;	</div><div class="line">//im_group_id:待激活的组ID</div><div class="line">//im_user_id:激活用户用户ID(等价环信ID)</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"code"</span>:<span class="number">0</span>,<span class="attr">"msg"</span>:<span class="string">"sucess"</span>,<span class="attr">"easemob_group_id"</span>:<span class="string">"19448358567937"</span>&#125;</div><div class="line">//因后台要调用环信接口，故此接口的响应时间有可能在3秒以上,app建议加个进度条，否则会使界面无响应</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="获取聊天群用户列表"><a href="#获取聊天群用户列表" class="headerlink" title="获取聊天群用户列表"></a>获取聊天群用户列表</h2><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getChatRoomUserList"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"im_group_id"</span>:<span class="number">710</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>,<span class="attr">"expanded"</span>:<span class="number">0</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">6</span>,<span class="attr">"values"</span>:[<span class="string">"im_user_id"</span>,<span class="string">"account_id"</span>,<span class="string">"real_name"</span>,<span class="string">"user_type"</span>,<span class="string">"remark"</span>,<span class="string">"isOwner"</span>,<span class="number">162077</span>,<span class="number">3179</span>,<span class="string">"沈贞辉"</span>,<span class="string">"teacher"</span>,<span class="string">"段长"</span>,<span class="number">0</span>,<span class="number">162317</span>,<span class="number">3419</span>,<span class="string">"竹子"</span>,<span class="string">"teacher"</span>,<span class="string">"初一(1)班"</span>,<span class="number">0</span>,<span class="number">162157</span>,<span class="number">3259</span>,<span class="string">"黄良材"</span>,<span class="string">"teacher"</span>,<span class="string">"初一(2)班"</span>,<span class="number">0</span>,<span class="number">162239</span>,<span class="number">3341</span>,<span class="string">"钟电昇"</span>,<span class="string">"teacher"</span>,<span class="string">"初一(3)班"</span>,<span class="number">0</span>,<span class="number">162320</span>,<span class="number">3422</span>,<span class="string">"陈科锦"</span>,<span class="string">"teacher"</span>,<span class="string">"初一(4)班"</span>,<span class="number">0</span>],<span class="attr">"rowCount"</span>:<span class="number">5</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>返回字段说明</p>
<ol>
<li>im_user_id：中心库中的用户ID</li>
<li>real_name：用户姓名</li>
<li>user_type：用户类型，值范围：’guardian’:家长,’teacher’:老师,’student’:学生</li>
<li>remark：备注信息</li>
<li>isOwner：是否是群主</li>
</ol>
</li>
</ul>
<h2 id="获取老师的聊天ID-环信ID"><a href="#获取老师的聊天ID-环信ID" class="headerlink" title="获取老师的聊天ID(环信ID)"></a>获取老师的聊天ID(环信ID)</h2><ul>
<li>请求</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getTeacherIMUserID"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"teacher_id"</span>:<span class="number">290</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;</div></pre></td></tr></table></figure>
<ul>
<li>响应</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">1</span>,<span class="attr">"values"</span>:[<span class="string">"im_user_id"</span>,<span class="number">162317</span>],<span class="attr">"rowCount"</span>:<span class="number">1</span>&#125;</div></pre></td></tr></table></figure>
<ul>
<li>返回的字段说明<ol>
<li>im_user_id：聊天ID</li>
<li>如果响应JSON中rowCount为0，表示获取失败，可能原因：用户还未上传到环信系统中、老师ID非法、数据还未同步到中心库</li>
</ol>
</li>
</ul>
<h2 id="获取学生的聊天ID-环信ID"><a href="#获取学生的聊天ID-环信ID" class="headerlink" title="获取学生的聊天ID(环信ID)"></a>获取学生的聊天ID(环信ID)</h2><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getStudentIMUserID"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"student_id"</span>:<span class="number">290</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">1</span>,<span class="attr">"values"</span>:[<span class="string">"im_user_id"</span>,<span class="number">159189</span>],<span class="attr">"rowCount"</span>:<span class="number">1</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>返回的字段说明</p>
<ol>
<li>im_user_id：聊天ID</li>
<li>如果响应JSON中rowCount为0，表示获取失败，可能原因：用户还未上传到环信系统中、学生ID非法、数据还未同步到中心库</li>
</ol>
</li>
</ul>
<h2 id="获取学生家长的聊天ID-环信ID"><a href="#获取学生家长的聊天ID-环信ID" class="headerlink" title="获取学生家长的聊天ID(环信ID)"></a>获取学生家长的聊天ID(环信ID)</h2><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getParentIMUserID"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"student_id"</span>:<span class="number">1</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">1</span>,<span class="attr">"values"</span>:[<span class="string">"im_user_id"</span>,<span class="number">254671</span>,<span class="number">254672</span>,<span class="number">254673</span>,<span class="number">254677</span>,<span class="number">254678</span>,<span class="number">296637</span>,<span class="number">296638</span>,<span class="number">341757</span>],<span class="attr">"rowCount"</span>:<span class="number">8</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>返回字段说明</p>
<ol>
<li>im_user_id：聊天ID</li>
<li>如果响应JSON中rowCount为0，表示获取失败，可能原因：用户还未上传到环信系统中、学生ID非法、数据还未同步到中心库</li>
<li>一个学生有可能有多个家长，需注意</li>
</ol>
</li>
</ul>
<h2 id="获取用户的聊天ID-学生、老师、家长"><a href="#获取用户的聊天ID-学生、老师、家长" class="headerlink" title="获取用户的聊天ID(学生、老师、家长)"></a>获取用户的聊天ID(学生、老师、家长)</h2><ul>
<li><p>请求</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getIMUserID"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"account_id_list"</span>:[<span class="number">3419</span>],<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;</div><div class="line">//account_id_list:数组，可以传多个account_id</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">2</span>,<span class="attr">"values"</span>:[<span class="string">"account_id"</span>,<span class="string">"im_user_id"</span>,<span class="number">3419</span>,<span class="number">162317</span>],<span class="attr">"rowCount"</span>:<span class="number">1</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>返回字段说明</p>
<ol>
<li>im_user_id：聊天ID</li>
<li>如果响应JSON中rowCount为0，表示获取失败，可能原因：用户还未上传到环信系统中、account_id非法、数据还未同步到中心库</li>
</ol>
</li>
</ul>
<h2 id="获取学生或老师的照片"><a href="#获取学生或老师的照片" class="headerlink" title="获取学生或老师的照片"></a>获取学生或老师的照片</h2><ul>
<li>签名使用的字段：school_id,account_id,timestamp,sign</li>
<li>如果有指定teacher_id则是获取老师照片</li>
<li>如果有指定student_id则是获取学生照片</li>
</ul>
<ul>
<li><p>通过account_id获取照片(学生或老师)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://IP:20001/api/userpic?school_id=6&amp;account_id=3640&amp;timestamp=1234560789101X&amp;sign=206de30cd2680ce61aece8ab34ff21e0</div></pre></td></tr></table></figure>
</li>
<li><p>通过teacher_id获取老师照片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">http://IP:20001/api/userpic?school_id=6&amp;account_id=3640&amp;teacher_id=290&amp;timestamp=1234560789101X&amp;sign=206de30cd2680ce61aece8ab34ff21e0</div><div class="line"><span class="comment">&lt;!-- account_id是用来签名使用的，此时可以传登录用户对应的account_id或者随便传一个也行 --&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>通过student_id获取学生照片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">http://IP:20001/api/userpic?school_id=6&amp;account_id=3640&amp;student_id=290&amp;timestamp=1234560789101X&amp;sign=206de30cd2680ce61aece8ab34ff21e0</div><div class="line"><span class="comment">&lt;!-- account_id是用来签名使用的，此时可以传登录用户对应的account_id或者随便传一个也行 --&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="IM集备组聊天记录获取与发送"><a href="#IM集备组聊天记录获取与发送" class="headerlink" title="IM集备组聊天记录获取与发送"></a>IM集备组聊天记录获取与发送</h2><h3 id="聊天记录列表获取"><a href="#聊天记录列表获取" class="headerlink" title="聊天记录列表获取"></a>聊天记录列表获取</h3><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getJiBeiChatLog"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,</div><div class="line"> <span class="attr">"grade_no"</span>:<span class="number">1</span>,<span class="attr">"course_id"</span>:<span class="number">2</span>,<span class="attr">"plan_id"</span>:<span class="number">1</span>,<span class="attr">"begin_time"</span>:<span class="string">"2017-06-09 00:00:00"</span>,<span class="attr">"end_time"</span>:<span class="string">"2017-06-09 23:59:59"</span>,</div><div class="line"> <span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>,<span class="attr">"expanded"</span>:<span class="number">0</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"fieldCount"</span>:<span class="number">13</span>,<span class="attr">"values"</span>:[<span class="string">"im_message_id"</span>,<span class="string">"sender_id"</span>,<span class="string">"account_id"</span>,<span class="string">"user_id_fk"</span>,<span class="string">"real_name"</span>,<span class="string">"easemob_type"</span>,<span class="string">"content"</span>,<span class="string">"easemob_filename"</span>,<span class="string">"easemob_length"</span>,<span class="string">"easemob_file_length"</span>,<span class="string">"easemob_width"</span>,<span class="string">"easemob_height"</span>,<span class="string">"msg_time"</span>,<span class="number">2006</span>,<span class="number">162317</span>,<span class="number">3419</span>,<span class="number">290</span>,<span class="string">"竹子"</span>,<span class="string">"TXT"</span>,<span class="string">"文本"</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">"2017-06-09T14:33:26"</span>,<span class="number">2007</span>,<span class="number">162317</span>,<span class="number">3419</span>,<span class="number">290</span>,<span class="string">"竹子"</span>,<span class="string">"VOICE"</span>,<span class="literal">null</span>,<span class="string">"1496990117711.amr"</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">"2017-06-09T14:35:32"</span>,<span class="number">2008</span>,<span class="number">162317</span>,<span class="number">3419</span>,<span class="number">290</span>,<span class="string">"竹子"</span>,<span class="string">"IMAGE"</span>,<span class="literal">null</span>,<span class="string">"1496990136165.jpeg"</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">"2017-06-09T14:35:50"</span>,<span class="number">2009</span>,<span class="number">162317</span>,<span class="number">3419</span>,<span class="number">290</span>,<span class="string">"竹子"</span>,<span class="string">"FILE"</span>,<span class="literal">null</span>,<span class="string">"1496990168149.jpg"</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="string">"2017-06-09T14:36:22"</span>],<span class="attr">"rowCount"</span>:<span class="number">4</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>手机端聊天界面<br><img src="/upload_image/集备组聊天界面.png" alt="集备组聊天界面"></p>
</li>
</ul>
<h3 id="下载文件-公司服务器先从环信服务器下载然后再回传"><a href="#下载文件-公司服务器先从环信服务器下载然后再回传" class="headerlink" title="下载文件(公司服务器先从环信服务器下载然后再回传)"></a>下载文件(公司服务器先从环信服务器下载然后再回传)</h3><ul>
<li><p>请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">http://</div><div class="line">:20001/api/easemob/file?school_id=6&amp;account_id=3640&amp;im_message_id=2007&amp;timestamp=1234560789101X&amp;sign=206de30cd2680ce61aece8ab34ff21e0</div><div class="line"><span class="comment">&lt;!-- account_id是用来签名使用的，此时可以传登录用户对应的account_id或者随便传一个也行 --&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="发送文本消息"><a href="#发送文本消息" class="headerlink" title="发送文本消息"></a>发送文本消息</h3><ul>
<li><p>请求</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"sendMsgToJiBeiChat"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3940</span>,</div><div class="line"> <span class="attr">"grade_no"</span>:<span class="number">1</span>,<span class="attr">"course_id"</span>:<span class="number">2</span>,<span class="attr">"msg"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"txt"</span>,<span class="attr">"msg"</span>:<span class="string">"消息文本内容"</span>&#125;,</div><div class="line"> <span class="attr">"ext"</span>:&#123;<span class="attr">"plan_id"</span>:<span class="number">1</span>,<span class="attr">"plan_name"</span>:<span class="string">"测试"</span>&#125;,</div><div class="line"> <span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"d14990fdd2d35fa8801d3f9eb81032b3"</span>&#125;</div><div class="line">//account_id:消息发送者</div><div class="line">//[school_id_id,grade_no,course_id] 指定集备组</div><div class="line">//ext:扩展字段(沿用环信接口),可以自行添加其他内容</div><div class="line">//plan_id：集备中的研究课题ID</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"code":0,"im_message_id":2013,"msg":"success"&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="通过im-group-id获取relation-id"><a href="#通过im-group-id获取relation-id" class="headerlink" title="通过im_group_id获取relation_id"></a>通过im_group_id获取relation_id</h2><ul>
<li><p>请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"getGroupRelationId"</span>,<span class="attr">"school_id"</span>:<span class="number">6</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,<span class="attr">"im_group_id"</span>:<span class="number">2433</span>,<span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span>&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"relation_id"</span>:<span class="number">58</span>&#125;</div><div class="line">//如果值为0表示没有找到</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="创建自定义聊天群"><a href="#创建自定义聊天群" class="headerlink" title="创建自定义聊天群"></a>创建自定义聊天群</h2><ul>
<li><p>请求</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"createCustomGroup"</span>,<span class="attr">"school_id"</span>:<span class="number">1</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,</div><div class="line"> <span class="attr">"groupname"</span>:<span class="string">"群组名称"</span>,</div><div class="line"> <span class="attr">"owner_account_id"</span>:<span class="number">0</span>,</div><div class="line"> <span class="attr">"owner_teacher_id"</span>:<span class="number">0</span>,</div><div class="line"> <span class="attr">"owner_student_id"</span>:<span class="number">0</span>,</div><div class="line"> <span class="attr">"members"</span>:&#123;</div><div class="line">   <span class="attr">"account_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"teacher_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"student_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"> &#125;,</div><div class="line"> <span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span></div><div class="line">&#125;	</div><div class="line">//群的创建者:owner_account_id,owner_teacher_id,owner_student_id,三个值只能传一个</div><div class="line">//members:可以同时传account_id、teacher_id、student_id键值</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="修改自定义聊天群"><a href="#修改自定义聊天群" class="headerlink" title="修改自定义聊天群"></a>修改自定义聊天群</h2><ul>
<li><p>请求</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"cmd"</span>:<span class="string">"modifyCustomGroup"</span>,<span class="attr">"school_id"</span>:<span class="number">1</span>,<span class="attr">"account_id"</span>:<span class="number">3419</span>,</div><div class="line"> <span class="attr">"im_group_id"</span>:<span class="number">0</span></div><div class="line"> <span class="string">"groupname"</span>:<span class="string">"群组名称"</span>,</div><div class="line"> <span class="attr">"addmembers"</span>:&#123;</div><div class="line">   <span class="attr">"account_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"teacher_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"student_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"> &#125;,</div><div class="line">  <span class="attr">"deletemembers"</span>:&#123;</div><div class="line">   <span class="attr">"account_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"teacher_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">   <span class="string">"student_id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"> &#125;,</div><div class="line"> <span class="attr">"timestamp"</span>:<span class="string">"1234560789101X"</span>,<span class="attr">"sign"</span>:<span class="string">"1f7be318563a1ad7b9f4eaada9adfd7a"</span></div><div class="line">&#125;</div><div class="line">//im_group_id:要修改的群ID</div><div class="line">//addmembers:新增群员</div><div class="line">//deletemembers:删除群员</div></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fjfzeagle.github.io/2017/08/03/IM接口文档/" data-id="cj5vvh7s500019gspbtw6f04f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IM/">IM</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/08/02/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IM/">IM</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/IM/" style="font-size: 10px;">IM</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/03/IM接口文档/">IM接口文档</a>
          </li>
        
          <li>
            <a href="/2017/08/02/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 清幽傲竹<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>